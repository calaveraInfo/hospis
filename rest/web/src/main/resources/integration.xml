<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:int="http://www.springframework.org/schema/integration" xmlns:int-jms="http://www.springframework.org/schema/integration/jms"
	xmlns:amq="http://activemq.apache.org/schema/core"
	xmlns:oxm="http://www.springframework.org/schema/oxm"
	xsi:schemaLocation="
       http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core-5.10.1.xsd
       http://www.springframework.org/schema/integration/jms http://www.springframework.org/schema/integration/jms/spring-integration-jms-4.1.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
       http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-4.1.xsd
       http://www.springframework.org/schema/oxm http://www.springframework.org/schema/oxm/spring-oxm-4.1.xsd">

<!-- 
 -->
	<int:gateway service-interface="cz.cestadomu.hospis.rest.web.gateway.TestGateway"
		default-request-channel="jmsOutboundChannel">
		<int:method name="greeting">
			<int:header name="route" value="test"/>
		</int:method>
	</int:gateway>

	<int:gateway service-interface="cz.cestadomu.hospis.rest.web.gateway.AuthenticationGateway"
		default-request-channel="jmsOutboundChannel">
		<int:method name="authenticate">
			<int:header name="route" value="authentication"/>
		</int:method>
	</int:gateway>

	<int:channel id="jmsOutboundChannel" />

	<int-jms:outbound-gateway request-destination-name="restRequest"
		request-channel="jmsOutboundChannel" connection-factory="jmsFactory"
		reply-destination-name="restResponse" correlation-key="JMSCorrelationID"
		message-converter="messageConverter">
		<int-jms:reply-listener/>
	</int-jms:outbound-gateway>
	
	<bean class="cz.cestadomu.hospis.rest.web.MyMarshallingMessageConverter" id="messageConverter">
		<property name="marshaller" ref="marshaller"/>
		<property name="unmarshaller" ref="marshaller"/>
	</bean>

	<oxm:jaxb2-marshaller id="marshaller">
		<oxm:class-to-be-bound name="cz.cestadomu.hospis.rest.web.model.Credentials"/>
	</oxm:jaxb2-marshaller>

	<amq:queue id="restRequest" physicalName="org.apache.activemq.spring.Test.spring.restRequests" />
	<amq:queue id="restResponse" physicalName="org.apache.activemq.spring.Test.spring.restResponse" />
	<amq:connectionFactory id="jmsFactory" brokerURL="tcp://localhost:1983" />

</beans>